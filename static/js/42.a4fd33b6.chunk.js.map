{"version":3,"file":"static/js/42.a4fd33b6.chunk.js","mappings":"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","sources":["../node_modules/@babel/runtime/helpers/esm/createClass.js","../node_modules/@babel/runtime/helpers/esm/classCallCheck.js","Vector2D.ts","../node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","../node_modules/@babel/runtime/helpers/esm/inherits.js","../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js","../node_modules/@babel/runtime/helpers/esm/typeof.js","../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js","../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js","../node_modules/@babel/runtime/helpers/esm/createSuper.js","../node_modules/@babel/runtime/helpers/esm/isNativeReflectConstruct.js","worker/WorkerCommand.ts","worker/ConvertCardCommand.ts","worker/ConvertSucceedCommand.ts","gencode/GenCode.ts"],"sourcesContent":["function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}","export default function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}","export default class Vector2D {\n    x: number;\n    y: number;\n    constructor(x: number, y: number) {\n        this.x = x;\n        this.y = y;\n    }\n}\n","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  Object.defineProperty(subClass, \"prototype\", {\n    writable: false\n  });\n  if (superClass) setPrototypeOf(subClass, superClass);\n}","export default function _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}","export default function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}","import _typeof from \"./typeof.js\";\nimport assertThisInitialized from \"./assertThisInitialized.js\";\nexport default function _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  } else if (call !== void 0) {\n    throw new TypeError(\"Derived constructors may only return object or undefined\");\n  }\n\n  return assertThisInitialized(self);\n}","export default function _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}","import getPrototypeOf from \"./getPrototypeOf.js\";\nimport isNativeReflectConstruct from \"./isNativeReflectConstruct.js\";\nimport possibleConstructorReturn from \"./possibleConstructorReturn.js\";\nexport default function _createSuper(Derived) {\n  var hasNativeReflectConstruct = isNativeReflectConstruct();\n  return function _createSuperInternal() {\n    var Super = getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = getPrototypeOf(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return possibleConstructorReturn(this, result);\n  };\n}","export default function _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}","export default abstract class WorkerCommand {\n  readonly abstract command: string;\n  public abstract getTransfer(): Array<Transferable>;\n}","import WorkerCommand from \"./WorkerCommand\";\nimport { ConvertInfo } from \"../ConvertOption\";\n\nconst commandName = 'convert-card';\n\nexport default class ConvertCardCommand extends WorkerCommand {\n  constructor(\n    public picture: Uint32Array, \n    public width: number,\n    public height: number,\n    public palleteLength: number,\n    public metaData: ConvertInfo,\n    public command = commandName\n  ) { super(); }\n\n  static from(obj: ConvertCardCommand) {\n    return new ConvertCardCommand(obj.picture, obj.width, obj.height, obj.palleteLength, obj.metaData);\n  }\n  getTransfer() { return [this.picture.buffer]; }\n  static is(data: WorkerCommand): data is ConvertCardCommand { return data.command === commandName; }\n}","import WorkerCommand from \"./WorkerCommand\";\nimport { ConvertInfo } from \"../ConvertOption\";\n\nconst commandName = 'convert-succeed';\n\nexport default class ConvertSucceedCommand extends WorkerCommand {\n  constructor(\n    public rectangleList: Uint32Array[],\n    public metaData: ConvertInfo,\n    public command = commandName\n  ) { super(); }\n\n  static from(obj: ConvertSucceedCommand) {\n    return new ConvertSucceedCommand(obj.rectangleList, obj.metaData);\n  }\n  getTransfer() { return this.rectangleList.map((v) => v.buffer); }\n  static is(data: WorkerCommand): data is ConvertSucceedCommand { return data.command === commandName; }\n}","import WorkerCommand from '../worker/WorkerCommand';\nimport Vector2D from '../Vector2D';\nimport ConvertCardCommand from '../worker/ConvertCardCommand';\nimport ConvertSucceedCommand from '../worker/ConvertSucceedCommand';\n\nexport default undefined;\n\n// eslint-disable-next-line\nconst ctx: Worker = self as any;\n\nctx.addEventListener('message', (evt: MessageEvent<WorkerCommand>) => {\n  const data = evt.data;\n  if (ConvertCardCommand.is(data)) {\n    const res: Uint32Array[] = [];\n    for (let i = 0; i < data.palleteLength; i++) {\n      res.push(convertLayer(data.picture, data.width, data.height, i));\n    }\n    const cmd = new ConvertSucceedCommand(res, data.metaData);\n    postMessage(cmd, cmd.getTransfer());\n  }\n});\n\n// 処理変更：既に切り出された画像に対して処理する\nfunction convertLayer(picture: Uint32Array, w: number, h: number, targetColor: number) {\n  const indexer = makeIndexer(w, h);  \n\n  const canDraw = (x: number, y: number) => (picture[indexer(x, y)] <= targetColor);\n  const cannotDraw = (x: number, y: number) => (picture[indexer(x, y)] > targetColor);\n  const rectangleMatrix = new Array<Array<Vector2D>>(h * w);\n  const drawCodes = Array<number>();\n \n  for (let y = 0; y < h; y++) {\n    for (let x = 0; x < w; x++) {\n      rectangleMatrix[indexer(x, y)] = new Array<Vector2D>();\n    }\n  }\n\n  for (let y = 0; y < h; y++) {\n    for (let x = 0; x < w; x++) {\n      // 矩形の左上頂点または左の辺または上の辺ならば\n      const ff: boolean = (canDraw(x, y))\n        && ((x === 0 || cannotDraw(x - 1, y)) || (y === 0 || cannotDraw(x, y - 1)));\n      if (ff) {\n        let tx: number, ty: number, ox!: number | undefined;\n        // 矩形を調査する（右に伸ばす）\n        for (ty = y; ty <= h; ty++) {\n          // 画像下辺かどうか\n          if (ty !== h) {\n            // 基準点から右にリーチする限界を調査\n            for (tx = x; tx < w && canDraw(tx, ty); tx++);\n            tx--;\n          } else {\n            tx = -1;\n          }\n\n          // 初回調査用の設定\n          if (ox === undefined) {\n            ox = tx;\n          }\n\n          // もし、前回よりx座標が手前に現れるならば\n          if (ox > tx) {\n            // 前回到達地点について調査：どの矩形からもはみ出る場合は\n            // 矩形情報を追加\n            if (!rectangleMatrix[indexer(ox, ty - 1)].some((e) => x > e.x && y > e.y)) {\n              rectangleMatrix[indexer(ox, ty - 1)].push(new Vector2D(x, y));\n            }\n            ox = tx;\n          }\n\n          if (tx < x) {\n            break;\n          }\n        }\n      }\n    }\n  }\n\n  const counter = new Uint8Array(w * h);\n  counter.fill(0);\n  for (let i = 0; i < rectangleMatrix.length; i++) {\n    const el = rectangleMatrix[i];\n    el?.forEach((v) => {\n      const ex = i % w, ey = Math.floor(i / w);\n      let f = false; // 未描画のエリアがあればtrue。falseの限りチェック\n      let f2 = false; // 自分の色が描画エリアにあればtrue\n      for (let ty = v.y; ty <= ey; ty++) {\n        for (let tx = v.x; tx <= ex; tx++) {\n          f = f || (counter[indexer(tx, ty)] === 0);\n          f2 = f2 || (picture[indexer(tx, ty)] === targetColor);\n        }\n      }\n\n      if (f && f2) {\n        drawCodes.push(v.x, v.y, ex - v.x + 1, ey - v.y + 1);\n        for (let ty = v.y; ty <= ey; ty++) {\n          for (let tx = v.x; tx <= ex; tx++) {\n            counter[indexer(tx, ty)] = 1;\n          }\n        }\n      }\n    });\n  }\n\n  return Uint32Array.from(drawCodes);\n}\n\nfunction makeIndexer(width: number, height: number) {\n  return (x: number, y: number) => {\n    return y * width + x;\n  }\n}"],"names":["_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","Constructor","protoProps","staticProps","prototype","_classCallCheck","instance","TypeError","Vector2D","x","y","this","_setPrototypeOf","o","p","setPrototypeOf","bind","__proto__","_inherits","subClass","superClass","create","constructor","value","_getPrototypeOf","getPrototypeOf","_typeof","obj","Symbol","iterator","_possibleConstructorReturn","self","call","ReferenceError","_createSuper","Derived","hasNativeReflectConstruct","Reflect","construct","sham","Proxy","Boolean","valueOf","e","result","Super","NewTarget","arguments","apply","WorkerCommand","command","commandName","ConvertCardCommand","picture","width","height","palleteLength","metaData","buffer","data","ConvertSucceedCommand","rectangleList","map","v","convertLayer","w","h","targetColor","indexer","canDraw","cannotDraw","rectangleMatrix","Array","drawCodes","tx","ty","ox","undefined","some","push","counter","Uint8Array","fill","el","forEach","ex","ey","Math","floor","f","f2","Uint32Array","from","addEventListener","evt","is","res","cmd","postMessage","getTransfer"],"sourceRoot":""}